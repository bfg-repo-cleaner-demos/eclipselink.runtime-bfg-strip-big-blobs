<?xml version="1.0"?>
<!--/*******************************************************************************
* This program and the accompanying materials are made available under the
* terms of the Eclipse Public License v1.0 and Eclipse Distribution License v. 1.0
* which accompanies this distribution.
* The Eclipse Public License is available at http://www.eclipse.org/legal/epl-v10.html
* and the Eclipse Distribution License is available at
* http://www.eclipse.org/org/documents/edl-v10.php.
*
*   Ant naming conventions:
*   - regardless of the actual OS platform,'/' is the directory separator
*     (Ant will convert as appropriate).
*   - multi-word properties use periods '.'
*   - multi-word targets use hyphens '-'
*   - multi-word macros use underscores '_'
*   - multi-word macro attributes are concatinated
*     e.g. 'runpathref'
*   - multi-word tasks (taskdef) names are concatinated
*     e.g. 'validateconnection'
*   - OS environment variables are in ALLCAPS and have 'env' as a prefix
*     e.g. ${env.XXX}.
*   - Ant properties are lower case.
*
* Contributors:
*     egwin - initial API and implementation
*     mnorman - fix to deal with basedir/path problems
#******************************************************************************/-->
<project
  name="org.eclipse.persistence.dbws"
  default="all"
  basedir="."
  >
  <!-- OS environment variables have 'env' as a prefix -->
  <property
    environment="env"
  />
  <!-- local property overrides -->
  <property
    file="${user.home}/build.properties"
  />
  <!-- find out where this build.xml file is -->
  <dirname
    property="eclipselink.dbws"
    file="${ant.file.org.eclipse.persistence.dbws}"
  />
  <!-- property checked into SVN -->
  <property
    file="${eclipselink.dbws}/build.properties"
  />
  <!-- Classpath used for compiling. -->
  <path
    id="compile.path"
    >
    <pathelement
      path="${eclipselink.core}/${classes.dir}"
    />
    <pathelement
      path="${eclipselink.jar.name}"
    />
    <pathelement
      path="${eclipselink.plugins}/${asm}"
    />
    <fileset
      dir="${eclipselink.plugins}"
      includes="${eclipselink.dbws.core.depend}"
    />
  </path>
  <presetdef name="javac">
    <javac
      debug="${javac.debug}"
      optimize="${javac.optimize}"
      source="${javac.version}"
      target="${javac.version}"
      deprecation="${javac.deprecation}"
      failonerror="true"
      memoryMaximumSize="512m"
      fork="true"
    />
  </presetdef>
  <presetdef
    name="DeleteDirQuietly"
    >
    <delete
      dir="_tmp_"
      quiet="true"
      failonerror="false"
    />
  </presetdef>
  <target
    name="all"
    depends="clean, create-jar"
    description="build EclipseLink jar"
  />
  <target
    name="clean"
    description="Clean all generated content"
    >
    <DeleteDirQuietly
      dir="${eclipselink.dbws}/${classes.dir}"
    />
  </target>
  <target
    name="verify-dependencies"
    description="verify core classes were compiled"
    >
    <available
      file="${eclipselink.core}/${classes.dir}/org/eclipse/persistence/Version.class"
      property="core.classes.exist"
    />
    <available
      file="${eclipselink.plugins}/${asm}"
      type="dir"
      property="asm.exist"
    />
    <fail
      unless="core.classes.exist"
      message="Core Classes cannot be found (check they compiled). Exiting..."
    />
    <fail
      unless="asm.exist"
      message="ASM Bundle cannot be found. Exiting..."
    />
  </target>
  <target
    name="compile"
    depends="verify-dependencies"
    description="build dbws classes"
    >
    <mkdir
      dir="${eclipselink.dbws}/${classes.dir}"
    />
    <javac
      srcdir="${eclipselink.dbws}/${src.dir}"
      destdir="${eclipselink.dbws}/${classes.dir}"
      includes="**/*.java"
      classpathref="compile.path"
    />
  </target>
  <!-- Packages dbws OSGI bundle jar. -->
  <target
    name="create-jar"
    depends="compile"
    description="Packages dbws OSGI bundle jar"
    >
    <DeleteDirQuietly
      dir="${eclipselink.dbws}/../${plugins.dir}"
    />
    <mkdir
      dir="${eclipselink.dbws}/../${plugins.dir}"
    />
    <jar
      jarfile="${eclipselink.dbws}/../${plugins.dir}/${eclipselink.dbws.bndl.prefix}.jar"
      manifest="${eclipselink.dbws}/META-INF/MANIFEST.MF"
      >
      <fileset
        dir="${eclipselink.dbws}/${classes.dir}"
        >
        <include
          name="org/eclipse/persistence/**/*.class"
        />
      </fileset>
      <fileset
        dir="${eclipselink.dbws}/${resource.dir}"
        >
        <include
          name="xsd/*.xsd"
        />
      </fileset>
    </jar>
  </target>
</project>