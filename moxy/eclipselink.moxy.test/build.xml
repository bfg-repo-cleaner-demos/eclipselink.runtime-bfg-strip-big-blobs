<project name="MOXy Testing" default="run.tests" basedir=".">
    <property file="./build.properties"/>
    <propertyset id="parser.properties">
	    <propertyref prefix="javax.xml"/>
	</propertyset>
    <path id="jaxb.compile.path">
        <pathelement path="${_javaeeJar}"/>
        <pathelement path="${_junitJar}"/>
        <pathelement path="${jaxb.source.classes.dir}"/>
        <pathelement path="${core.classes.dir}"/>
    </path>
    <path id="jaxb.run.path">
        <pathelement path="${core.resource.dir}"/>
        <pathelement path="${test.resource.dir}"/>
        <pathelement path="${test.classes.dir}"/>
        <path refid="jaxb.compile.path"/>
    </path>
    <path id="oxm.compile.path">
        <pathelement path="${_javaeeJar}"/>
        <pathelement path="${_junitJar}"/>
		<path refid="jaxb.compile.path"/>
    </path>
    <path id="oxm.run.path">
        <path refid="oxm.compile.path"/>
        <pathelement path="${core.resource.dir}"/>
        <pathelement path="${test.resource.dir}"/>
        <pathelement path="${test.classes.dir}"/>
        <pathelement path="${jaxb.source.classes.dir}"/>
    </path>
	<target name="run.tests" depends="compile.tests, clean.report, run.oxm.tests, run.oxm.sax.tests, run.oxm.deploymentxml.tests, run.oxm.docpres.tests,run.jaxb.tests, update.package.names, junit.report"/>
	<target name="compile.tests" depends="clean, compile.core, compile.jaxb, compile.oxm.tests, compile.jaxb.tests"/>
    <target name="clean">
        <delete includeEmptyDirs="true" failonerror="false">
            <fileset dir="${test.classes.dir}"/>
        </delete>
		<mkdir dir="${test.classes.dir}"/>
    </target>
	<target name="compile.core">
		<ant antfile="${_foundationDir}/eclipselink.core/build.xml" target="all" inheritAll="false"/>
	</target>
	<target name="compile.jaxb">
		<ant antfile="${basedir}/../eclipselink.moxy/build.xml" target="compile.moxy" inheritAll="false"/>
	</target>
	<target name="compile.oxm.tests">
	   <javac srcdir="${test.source.dir}"
              destdir="${oxm.classes.dir}"
              includes="${oxm.package}**/*.java">
			  <classpath>
                  <path refid="oxm.compile.path"/>
              </classpath>
		</javac>
	</target>
	<target name="compile.jaxb.tests">
	     <javac srcdir="${test.source.dir}"
            destdir="${jaxb.classes.dir}"
            includes="${jaxb.package}**/*.java">
            <classpath>
                <path refid="jaxb.compile.path"/>
            </classpath>
		</javac>
	</target>
	<target name="run.jaxb.tests">
	    <mkdir dir="${jaxb.reports.dir}"/>
	    <mkdir dir="${tmp.dir}"/>
		<junit printsummary="yes" fork="true" dir="${basedir}/resource" showoutput="yes">
		    <env key="T_WORK" value="${tmp.dir}"/>
			<sysproperty key="useDeploymentXML" value="false"/>
			<sysproperty key="useSAXParsing" value="false"/>
			<sysproperty key="useLogging" value="false"/>
			<sysproperty key="eclipselink.xml.platform" value="${xml.platform}"/>
			<sysproperty key="parser" value="${parser}"/>
			<syspropertyset refid="parser.properties"/>
			<batchtest todir="${jaxb.reports.dir}">
			    <fileset dir="${test.source.dir}">
				    <include name="**/JAXBTestSuite.java"/>
				</fileset>
				<formatter type="xml"/>
			</batchtest>
            <classpath>
                <path refid="jaxb.run.path"/>
            </classpath>
		</junit>
		<junitreport todir="${jaxb.reports.dir}">
			<fileset dir="${jaxb.reports.dir}">
				<include name="**/*.xml"/>
			</fileset>
			<report format="noframes" todir="${jaxb.reports.dir}"/>
		</junitreport>		
        <delete includeEmptyDirs="true" failonerror="false">
            <fileset dir="${tmp.dir}"/>
			<fileset dir="${jaxb.reports.dir}">
				<include name="**/*.xml"/>
			</fileset>
            <fileset dir="${basedir}/resource">
				<include name="File*.xml"/>
			</fileset>
        </delete>
	</target>
    <target name="run.oxm.tests">
	    <mkdir dir="${oxm.default.reports.dir}"/>
	    <mkdir dir="${tmp.dir}"/>
        <junit printsummary="yes" fork="true" dir="${basedir}/resource" showoutput="yes">
		    <env key="T_WORK" value="${tmp.dir}"/>
		    <sysproperty key="useDeploymentXML" value="false"/>
			<sysproperty key="useSAXParsing" value="false"/>
			<sysproperty key="useDocPres" value="false"/>
			<sysproperty key="useLogging" value="false"/>
			<sysproperty key="eclipselink.xml.platform" value="${xml.platform}"/>
			<sysproperty key="parser" value="${parser}"/>
			<syspropertyset refid="parser.properties"/>
			<batchtest todir="${oxm.default.reports.dir}">
		        <fileset dir="${test.source.dir}">
					<include name="**/*TestSuite.java"/>
					<include name="**/ClassLoaderTestCases.java"/>
					<exclude name="**/JAXBSAXTestSuite.java"/>
					<exclude name="**/JAXBTestSuite.java"/>
					<exclude name="**/OXTestSuite.java"/>
					<exclude name="**/OneTo*TestSuite.java"/>
					<exclude name="**/DeploymentXMLOXTestSuite.java"/>						
					<exclude name="org/eclipse/persistence/testing/oxm/mappings/MappingTestSuite.java"/>
					<exclude name="org/eclipse/persistence/testing/oxm/mappings/DeploymentXMLMappingTestSuite.java"/>
					<exclude name="org/eclipse/persistence/testing/oxm/mappings/DocPresMappingTestSuite.java"/>
					<exclude name="org/eclipse/persistence/testing/oxm/mappings/SAXMappingTestSuite.java"/>
					<exclude name="org/eclipse/persistence/testing/oxm/mappings/anyobjectandanycollection/XMLAnyObjectAndAnyCollectionMappingTestSuite.java"/>
	    		</fileset>
		    	<formatter type="xml"/>
    		</batchtest>
	    	<classpath refid="oxm.run.path"/>
		</junit>
	</target>
    <target name="run.oxm.sax.tests">
	    <mkdir dir="${oxm.sax.reports.dir}"/>
	    <mkdir dir="${tmp.dir}"/>
        <junit printsummary="yes" fork="true" dir="${basedir}/resource" showoutput="yes">
		    <sysproperty key="useDeploymentXML" value="false"/>
			<sysproperty key="useSAXParsing" value="true"/>
			<sysproperty key="useDocPres" value="false"/>
			<sysproperty key="useLogging" value="false"/>
			<sysproperty key="eclipselink.xml.platform" value="${xml.platform}"/>
			<sysproperty key="parser" value="${parser}"/>
			<syspropertyset refid="parser.properties"/>
			<batchtest todir="${oxm.sax.reports.dir}">
		        <fileset dir="${test.source.dir}">
					<include name="**/*MappingTestSuite.java"/>
					<include name="**/InheritanceTestSuite.java"/>
					<include name="**/XMLMarshalTestCases.java"/>
					<include name="**/XMLMarshalFragmentTestCases.java"/>
					<include name="**/XMLUnmarshalTestCases.java"/>
					<include name="**/XMLMarshallerValidationModeTestCases.java"/>
					<include name="**/*amespaceTestSuite.java"/>
					<include name="**/ClassLoaderTestCases.java"/>
					<exclude name="**/MappingTestSuite.java"/>
					<exclude name="**/OneTo*TestSuite.java"/>
					<exclude name="**/DeploymentXMLMappingTestSuite.java"/>
			        <exclude name="org/eclipse/persistence/testing/oxm/mappings/DocPresMappingTestSuite.java"/>
                    <exclude name="org/eclipse/persistence/testing/oxm/mappings/anyobjectandanycollection/XMLAnyObjectAndAnyCollectionMappingTestSuite.java"/>
					<exclude name="**/SAXMappingTestSuite.java"/>
	    		</fileset>
		    	<formatter type="xml"/>
    		</batchtest>
	    	<classpath refid="oxm.run.path"/>
		</junit>
	</target>
	<target name="run.oxm.deploymentxml.tests">
	    <mkdir dir="${oxm.deploymentxml.reports.dir}"/>
	    <mkdir dir="${tmp.dir}"/>
        <junit printsummary="yes" fork="true" dir="${basedir}/resource" showoutput="yes">
		    <sysproperty key="useDeploymentXML" value="true"/>
			<sysproperty key="useSAXParsing" value="false"/>
			<sysproperty key="useDocPres" value="false"/>
			<sysproperty key="useLogging" value="false"/>
			<sysproperty key="eclipselink.xml.platform" value="${xml.platform}"/>
			<sysproperty key="parser" value="${parser}"/>
			<syspropertyset refid="parser.properties"/>
			<batchtest todir="${oxm.deploymentxml.reports.dir}">
		        <fileset dir="${test.source.dir}">
					<include name="**/DocumentPreservationTestSuite.java"/>
					<include name="**/RootElementTestSuite.java"/>
					<include name="**/XMLRootTestSuite.java"/>
					<include name="**/XMLMarshalTestCases.java"/>
					<include name="**/XMLMarshalFragmentTestCases.java"/>
					<include name="**/XMLUnmarshalTestCases.java"/>
					<include name="**/ReadOnlyTestSuite.java"/>
					<include name="**/InheritanceTestSuite.java"/>
					<include name="**/ConverterTestSuite.java"/>
					<include name="**/*MappingTestSuite.java"/>
					<include name="**/ClassLoaderTestCases.java"/>
					<include name="**/*amespaceTestSuite.java"/>
					<include name="**/JAXBDOMTestSuite.java"/>
					<exclude name="**/JAXBSAXTestSuite.java"/>
					<exclude name="**/JAXBTestSuite.java"/>
					<exclude name="**/OneTo*TestSuite.java"/>
					<exclude name="org/eclipse/persistence/testing/oxm/mappings/MappingTestSuite.java"/>
					<exclude name="org/eclipse/persistence/testing/oxm/mappings/DeploymentXMLMappingTestSuite.java"/>
					<exclude name="org/eclipse/persistence/testing/oxm/mappings/DocPresMappingTestSuite.java"/>
					<exclude name="org/eclipse/persistence/testing/oxm/mappings/SAXMappingTestSuite.java"/>
					<exclude name="org/eclipse/persistence/testing/oxm/mappings/anyobjectandanycollection/XMLAnyObjectAndAnyCollectionMappingTestSuite.java"/>
					<exclude name="org/eclipse/persistence/testing/oxm/mappings/binarydata/XMLBinaryDataMappingTestSuite.java"/>
					<exclude name="org/eclipse/persistence/testing/oxm/mappings/binarydatacollection/XMLBinaryDataCollectionMappingTestSuite.java"/>
	    		</fileset>
		    	<formatter type="xml"/>
    		</batchtest>
	    	<classpath refid="oxm.run.path"/>
		</junit>
	</target>
	<target name="run.oxm.docpres.tests">
	    <mkdir dir="${oxm.docpres.reports.dir}"/>
	    <mkdir dir="${tmp.dir}"/>
        <junit printsummary="yes" fork="true" dir="${basedir}/resource" showoutput="yes">
		    <env key="T_WORK" value="${tmp.dir}"/>
		    <sysproperty key="useDeploymentXML" value="false"/>
			<sysproperty key="useSAXParsing" value="false"/>
			<sysproperty key="useDocPres" value="true"/>
			<sysproperty key="useLogging" value="false"/>
			<sysproperty key="eclipselink.xml.platform" value="${xml.platform}"/>
			<sysproperty key="parser" value="${parser}"/>
			<syspropertyset refid="parser.properties"/>
			<batchtest todir="${oxm.docpres.reports.dir}">
		        <fileset dir="${test.source.dir}">
					<include name="**/*TestSuite.java"/>
					<include name="**/ClassLoaderTestCases.java"/>
					<exclude name="**/JAXBSAXTestSuite.java"/>
					<exclude name="**/JAXBTestSuite.java"/>
					<exclude name="**/ReadOnlyTestSuite.java"/>
					<exclude name="**/OXTestSuite.java"/>
					<exclude name="**/OneTo*TestSuite.java"/>
					<exclude name="**/DeploymentXMLOXTestSuite.java"/>						
					<exclude name="org/eclipse/persistence/testing/oxm/mappings/MappingTestSuite.java"/>
					<exclude name="org/eclipse/persistence/testing/oxm/mappings/DeploymentXMLMappingTestSuite.java"/>
					<exclude name="org/eclipse/persistence/testing/oxm/mappings/DocPresMappingTestSuite.java"/>
					<exclude name="org/eclipse/persistence/testing/oxm/mappings/SAXMappingTestSuite.java"/>
					<exclude name="org/eclipse/persistence/testing/oxm/mappings/anyobjectandanycollection/XMLAnyObjectAndAnyCollectionMappingTestSuite.java"/>
					<exclude name="org/eclipse/persistence/testing/oxm/mappings/keybased/KeyBasedMappingTestSuite.java"/>
	    		</fileset>
		    	<formatter type="xml"/>
    		</batchtest>
	    	<classpath refid="oxm.run.path"/>
		</junit>
	</target>
	<target name="update.package.names" depends="update.sax.package, update.deploymentxml.package, update.docpres.package"/>
	<target name="update.sax.package">
		<replace dir="${oxm.sax.reports.dir}" value='"org.eclipse.persistence.testing.oxm.sax'
			token='"org.eclipse.persistence.testing.oxm'>
			  <include name="**/*.xml"/>
		</replace>
	</target>
	<target name="update.deploymentxml.package">
		<replace dir="${oxm.deploymentxml.reports.dir}" value='"org.eclipse.persistence.testing.oxm.deploymentxml'
			token='"org.eclipse.persistence.testing.oxm'>
			  <include name="**/*.xml"/>
		</replace>
	</target>
	<target name="update.docpres.package">
		<replace dir="${oxm.docpres.reports.dir}" value='"org.eclipse.persistence.testing.oxm.docpres'
			token='"org.eclipse.persistence.testing.oxm'>
			  <include name="**/*.xml"/>
		</replace>
	</target>
	<target name="junit.report">
		<mkdir dir="${oxm.reports.dir}"/>
		<junitreport todir="${oxm.reports.dir}">
			<fileset dir="${oxm.reports.dir}">
				<include name="**/*.xml"/>
			</fileset>
			<report format="noframes" todir="${oxm.reports.dir}"/>
		</junitreport>		
        <delete dir="${oxm.default.reports.dir}" failonerror="false"/>
        <delete dir="${oxm.sax.reports.dir}" failonerror="false"/>
        <delete dir="${oxm.deploymentxml.reports.dir}" failonerror="false"/>
        <delete dir="${oxm.docpres.reports.dir}" failonerror="false"/>
        <delete failonerror="false">
			<fileset dir="${oxm.reports.dir}">
				<include name="**/*.xml"/>
			</fileset>
        </delete>
	</target>
	<target name="clean.report">
        <delete includeEmptyDirs="true" failonerror="false">
			<fileset dir="${oxm.reports.dir}">
				<include name="**/*.xml"/>
			</fileset>
        </delete>
	</target>
</project>	