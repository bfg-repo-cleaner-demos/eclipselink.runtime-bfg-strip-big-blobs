<!--/*******************************************************************************
* Copyright (c) 2007 Oracle. All rights reserved.
* This program and the accompanying materials are made available under the terms of
* the Eclipse Public License v1.0, which accompanies this distribution and is available at
* http://www.eclipse.org/legal/epl-v10.html.
*
* Contributors:
*     Oracle - initial API and implementation
#******************************************************************************/-->

<project name="Build Mappings Plug-in Tests" default="build.all" basedir=".">
    <!-- =================================================================== -->
    <target name="init">
        <tstamp>
            <format property="BldDate" pattern="yyMMdd"/>
            <format property="BldTime" pattern="HHmm"/>
        </tstamp>
        <property environment="env"/>

        <property name="_stop_on_err" value="false"/>
        <property name="_optimize"    value="off"/>
        <property name="_deprecation" value="off"/>
        <property name="_debug"       value="on"/>
        <property name="_targetjvm"   value="1.5"/>
        <echo message="BldDate.BldTime='${BldDate}.${BldTime}'"/>
        <echo message="java.version='${java.version}'"/>
        <echo message="os.name='${os.name}'"/>
        <echo message="os.arch='${os.arch}'"/>
        <echo message="os.version='${os.version}'"/>
        <echo message="_stop_on_err='${_stop_on_err}'"/>
        <echo message="_optimize='${_optimize}'"/>
        <echo message="_deprecation='${_deprecation}'"/>
        <echo message="_targetjvm='${_targetjvm}'"/>
    </target>
    <!-- =================================================================== -->
    <!-- =================================================================== -->
    <target name="set.release" unless="_g" depends="init">
        <property name="debugPostfix" value=""/>
        <property name="_debuglvl"     value="lines,source"/>
        <property name="_debugOff"    value="true"/>
        <echo message="_debuglvl='${_debuglvl}'"/>
        <echo message="_debugOff='${_debugOff}'"/>
        <echo message="debugPostfix='${debugPostfix}'"/>
    </target>

    <target name="set.debug" if="_g" depends="set.release">
        <property name="debugPostfix" value="_g"/>
        <property name="_debuglvl"     value="lines,vars,source"/>
        <echo message="_debuglvl='${_debuglvl}'"/>
        <echo message="_debugOff not defined."/>
        <echo message="debugPostfix='${debugPostfix}'"/>
    </target>

    <!-- =================================================================== -->
    <!-- =================================================================== -->

    <target name="build.all" depends="compile.mappingsplugin, jar.mappingsplugin"/>

    <!-- =================================================================== -->
    <!--  Properties                                                         -->
    <!-- =================================================================== -->
    <target name="_properties.init" depends="set.debug">
        <property file="build.properties"/>
        <mkdir dir="${_classesDestDir}"/>
        <mkdir dir="${_jarDestDir}"/>
    	<condition property="junit.classpath.exist" >
    		<isset property="junit.classpath"/>
    	</condition>
    </target>

    <!-- =================================================================== -->
    <!--  Clean                                                              -->
    <!-- =================================================================== -->
    <target name="clean" depends="set.debug">
        <property file="build.properties"/>

        <delete dir="${_classesDestDir}" includeEmptyDirs="true" quiet="true"/>
        <delete file="${_jarDestDir}/${mappingsplugin.jarfile}" quiet="true"/>
    </target>

    <!-- =================================================================== -->
    <!--  Compile                                                            -->
    <!-- =================================================================== -->
    <target name="compile.mappingsplugin" depends="_properties.init">
        <mkdir dir="${compile.mappingsplugin.destdir}"/>
        <javac
            classpath="${compile.mappingsplugin.classpath}"
            srcdir="${compile.mappingsplugin.srcdir}"
            destdir="${compile.mappingsplugin.destdir}"
            debug="${_debug}"
            debuglevel="${_debuglvl}"
            failonerror="${_stop_on_err}"
            optimize="${_optimize}"
            deprecation="${_deprecation}"
            target="${_targetjvm}"
            includes="**/*.java"
            excludes="**/*&#35;*/**, **/.ade_path/**"
        />
    </target>

    <!-- =================================================================== -->
    <!--  Jar                                                                -->
    <!-- =================================================================== -->
    <target name="jar.mappingsplugin" depends="jar.mappingsplugin.lib, jar.mappingsplugin.src"/>

    <target name="jar.mappingsplugin.lib" if="_debugOff" depends="_properties.init">
        <delete file="${_jarDestDir}/${mappingsplugin.jarfile}"/>
        <jar jarfile="${_jarDestDir}/${mappingsplugin.jarfile}">
            <manifest>
                <attribute name="Specification-Title" value="Oracle9iAS TopLink Mappings Plug-in Tests" />
                <attribute name="Specification-Vendor" value="Oracle Corporation" />
                <attribute name="Specification-Version" value="${_VersionStamp}" />
                <attribute name="Implementation-Title" value="test.org.eclipse.persistence.workbench.mappingsplugin" />
                <attribute name="Implementation-Version" value="${_VersionStamp}.${_buildNumber}" /> 
                <attribute name="Implementation-Vendor" value="Oracle Corporation" />
            </manifest>
            <fileset
                dir="${compile.mappingsplugin.destdir}"
                includes="**/*.class"
            />
        </jar>
    </target>
    <target name="jar.mappingsplugin.src" unless="_debugOff" depends="_properties.init">
        <delete file="${_jarDestDir}/${mappingsplugin.jarfile}"/>
        <jar jarfile="${_jarDestDir}/${mappingsplugin.jarfile}">
            <manifest>
                <attribute name="Specification-Title" value="Oracle9iAS TopLink Mappings Plug-in Tests" />
                <attribute name="Specification-Vendor" value="Oracle Corporation" />
                <attribute name="Specification-Version" value="${_VersionStamp}" />
                <attribute name="Implementation-Title" value="test.org.eclipse.persistence.workbench.mappingsplugin" />
                <attribute name="Implementation-Version" value="${_VersionStamp}.${_buildNumber}" /> 
                <attribute name="Implementation-Vendor" value="Oracle Corporation" />
            </manifest>
            <fileset
                dir="${compile.mappingsplugin.destdir}"
                includes="**/*.class"
            />
            <fileset
                dir="${compile.mappingsplugin.srcdir}"
                includes="**/*.java"
                excludes="**/*&#35;*/**, **/.ade_path/**"
            />
        </jar>
    </target>

    <!-- =================================================================== -->
    <!--  JUnit tests - run this target from the master build project only.  -->
    <!-- =================================================================== -->

    <target name="test.all" depends="test.mappingsmodel,
                                     test.mappingsplugin, 
									 test.mappingsio"/>
	
    <target name="checkClasspath" depends="_properties.init" unless="junit.classpath.exist">
	    <echo message="Run this target from the master build project only." />
    	<fail>Run the master build project</fail>
    </target>
	
    <target name="test.mappingsmodel" depends="checkClasspath">
        <junit>
        	<classpath path="${junit.classpath}" />
            <formatter type="brief" usefile="false" />
            <test name="test.org.eclipse.persistence.workbench.mappingsmodel.AllMappingsModelTests" />
        </junit>
    </target>
	
    <target name="test.mappingsplugin" depends="checkClasspath">
        <junit>
        	<classpath path="${junit.classpath}" />
            <formatter type="brief" usefile="false" />
            <test name="test.org.eclipse.persistence.workbench.mappingsplugin.AllMappingsPluginTests" />
        </junit>
    </target>
	
    <target name="test.mappingsio" depends="checkClasspath">
        <junit>
        	<classpath path="${junit.classpath}" />
            <formatter type="brief" usefile="false" />
            <test name="test.org.eclipse.persistence.workbench.mappingsio.AllMappingsIOTests" />
        </junit>
    </target>
	
</project>
